이 프로젝트는 python을 배울 수 있는 pyscript 프로젝트야. 이 프로젝트에 아래와 같은 문제가 있어. 이 코드를 분석해 아래 문제를 해결해줘.

문제:
1. 주인공 캐릭터를 클릭하면 정보가 뜨는데 이 정보가 한참 후에 사라지고
2. 아이템(item)이나 몹(mob) 캐릭터, 벽(wall)을 배치하면 배치를 취소할 수 있는 기능이 없어.

해결 방법:
1. 주인공 캐릭터의 정보가 ESC를 누르면 사라지도록 수정해줘.
2. 몹 캐릭터와 벽, 아이템의 경우에 마우스 오른쪽 버튼을 클릭하면 삭제되었으면 좋겠어.

주의 사항:
1. 단순히 아이템, 캐릭터, 벽을 UI에서 제거하는 것이 아니라, 이것을 저장하고 있는 행렬 값이 있는데 여기에서도 그 값을 수정 또는 제거해줘야 해.
2. 지금까지 요청이 모두 위 요청을 해결하지 못했어. 그렇기 때문에 먼저 전략을 세우고, 차례대로 해결해줘야 해.

---

## 구현 시 참고사항 (Claude 작성)

### 프로젝트 구조
- **메인 스크립트**: `assets/py/script.py` - 이벤트 핸들러, UI 로직
- **데이터 저장소**: `assets/py/coordinate.py` - 전역 데이터 (아래 참고)
- **CSS**: `assets/css/style.css`

### 핵심 데이터 구조 (coordinate.py)
```python
# 아이템 데이터 - 딕셔너리, 키는 (x, y) 튜플
item_data = {
    (0, 1): {"item": "fish-1", "count": 1},
    (2, 2): {"item": "diamond", "count": 3},
}

# 캐릭터 데이터 - 리스트
character_data = [
    {"character": "licat", "x": 0, "y": 0, ...},
]

# 몹 데이터 - 리스트
mob_data = [
    {"name": "wizard1", "mob": "wizard", "x": 2, "y": 3, ...},
]

# 벽 데이터 - 딕셔너리
wall_data = {
    "world": {
        (0.5, 0): "wall",
        (1.5, 2): "fence",
    }
}
```

### 좌표 체계
- **맵 좌표**: (x: 행, y: 열) - 0부터 시작
- **1D 배열 인덱스 변환**: `index = map_data['width'] * x + y`
- **벽 좌표**: 특수 - 세로벽 (정수.x, 0.5n), 가로벽 (0.5n, 정수.y)

### 이벤트 처리 방식
- PyScript의 `@when` 데코레이터: 정적 요소에만 작동
- 동적 요소: `add_event_listener()` 사용 필요
- **우클릭 이벤트**: `contextmenu` 이벤트 사용, `evt.preventDefault()` 필요

### 구현 전략
1. **ESC 키로 캐릭터 정보 팝업 닫기**
   - `keydown` 이벤트 리스너 등록
   - `.character-info-bubble` 요소 제거

2. **우클릭으로 삭제 (아이템, 몹, 벽)**
   - `contextmenu` 이벤트 사용 (우클릭)
   - `evt.preventDefault()`로 기본 컨텍스트 메뉴 방지
   - 데이터 구조에서 해당 항목 삭제
   - UI에서 요소 제거

3. **데이터 동기화**
   - 아이템: `del item_data[(x, y)]`
   - 몹: `mob_data.remove(mob_info)`
   - 벽: `del wall_data['world'][(x, y)]` + `wall.wall_data` 동기화

### 주의사항
- 기존 좌클릭 기능(배치, 선택 등)을 방해하지 않아야 함
- 스토리 모드에서는 삭제 기능 비활성화
- 메인 캐릭터(licat)는 삭제 불가

---

## 현재 구현 상태 (2024년 테스트 결과)

### 완료된 기능
1. **ESC 키로 캐릭터 정보 팝업 닫기** - ✅ 완료
2. **벽 우클릭 삭제** - ✅ 완료 (정상 작동)

### 미해결 문제

#### 1. 아이템 우클릭 삭제 - ❌ 작동 안 함
**증상**: 아이템을 우클릭해도 삭제되지 않음

**원인 분석 필요**:
- `.item-container` 요소에 이벤트가 도달하지 않을 수 있음
- 아이템 이미지(`img.item`)를 클릭하면 `evt.target.closest('.item-container')`가 제대로 작동하는지 확인 필요
- `.item-container`의 CSS에 `pointer-events` 관련 설정 확인 필요

**디버깅 방법**:
```python
# handle_world_contextmenu 함수 시작 부분에 추가
js.console.log('contextmenu target:', evt.target)
js.console.log('target classList:', evt.target.classList)
js.console.log('closest item-container:', evt.target.closest('.item-container'))
```

**가능한 해결책**:
1. `.item-container` 또는 `.item` 클래스에 직접 `@when('contextmenu', selector='.item-container')` 데코레이터 추가
2. 아이템 이미지(`.item`)에도 우클릭 이벤트 처리 추가
3. CSS에서 `pointer-events: auto` 확인

#### 2. 몹 우클릭 삭제 - ❌ 이미지 경로 오류
**증상**: "이미지 경로를 찾을 수 없음" 오류 발생

**원인 분석**:
- 몹 삭제 로직 자체는 문제없을 수 있음
- 오류 메시지가 삭제와 무관한 다른 곳에서 발생할 가능성
- 몹의 이미지 경로가 `assets/img/characters/{mob_type}-0.png` 형식인데, 삭제 시 관련 리소스 정리 문제일 수 있음

**디버깅 방법**:
```python
# handle_world_contextmenu 함수의 몹 삭제 부분에 추가
js.console.log('mob_elem:', mob_elem)
js.console.log('mob_name:', mob_name)
js.console.log('mob_data before:', mob_data)
```

**가능한 해결책**:
1. 오류 메시지가 정확히 어디서 발생하는지 콘솔 로그로 확인
2. 몹 삭제 시 `mob_obj` 객체의 정리가 필요한지 확인
3. 이미지 경로 오류가 삭제 후 UI 갱신 과정에서 발생하는지 확인

---

## 코드 위치 참고

### 현재 우클릭 삭제 로직 위치
- **파일**: `assets/py/script.py`
- **함수**: `handle_world_contextmenu()` (약 852번 줄)
- **벽 전용 함수**: `handle_wall_contextmenu_direct()` (약 970번 줄)

### 아이템 관련 코드
- **Item 클래스**: `assets/py/item.py`
- **아이템 배치**: `script.py`의 `map_item_add()` 함수
- **아이템 데이터**: `coordinate.py`의 `item_data` 딕셔너리

### 몹 관련 코드
- **Mob 클래스**: `assets/py/mob.py`
- **몹 추가**: `script.py`의 `add_mob()` 함수
- **몹 데이터**: `coordinate.py`의 `mob_data` 리스트

---

## 다음 시도 시 권장 사항

1. **브라우저 개발자 도구(F12) 활용**
   - Console 탭에서 오류 메시지 정확히 확인
   - Network 탭에서 이미지 로딩 실패 확인

2. **단계별 디버깅**
   - 우클릭 이벤트가 발생하는지 확인 (console.log)
   - `evt.target`이 예상한 요소인지 확인
   - 데이터 삭제가 실제로 이루어지는지 확인

3. **CSS 확인**
   - `.item-container`, `.mob` 요소의 `pointer-events` 속성 확인
   - 요소가 다른 요소에 가려져 있지 않은지 확인 (z-index)

4. **이벤트 버블링 확인**
   - 아이템/몹의 부모 요소에서 이벤트가 중단되지 않는지 확인
   - `stopPropagation()`이 잘못된 곳에서 호출되지 않는지 확인
